<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Toggle Control Panel</title>
  <style>
    .toggle, .indicator {
      display: inline-block;
      margin: 10px;
      padding: 10px 20px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .active {
      background-color: lightgreen;
    }

    .indicator {
      background-color: #f2f2f2;
    }

    .indicator.active {
      background-color: lightskyblue;
    }
  </style>
</head>
<body>
  <h1>Control Panel</h1>

  <h2>Outputs</h2>
  <div id="toggles">
    <button class="toggle" id="out1" onclick="toggle(1)">OUT 1</button>
    <button class="toggle" id="out2" onclick="toggle(2)">OUT 2</button>
    <button class="toggle" id="out3" onclick="toggle(3)">OUT 3</button>
    <button class="toggle" id="out4" onclick="toggle(4)">OUT 4</button>
    <button class="toggle" id="out5" onclick="toggle(5)">OUT 5</button>
    <button class="toggle" id="out6" onclick="toggle(6)">OUT 6</button>
  </div>

  <h2>Inputs</h2>
  <div id="inputs">
    <div class="indicator" id="in1">IN 1</div>
    <div class="indicator" id="in2">IN 2</div>
    <div class="indicator" id="in3">IN 3</div>
    <div class="indicator" id="in4">IN 4</div>
    <div class="indicator" id="in5">IN 5</div>
    <div class="indicator" id="in6">IN 6</div>
  </div>

  <script>
    let outputPorts = {}

    // === Переключение кнопок ===
    function toggle(index) {
      const key = String(index)
      const button = document.getElementById(`out${key}`)

      outputPorts[key] = outputPorts[key] === 1 ? 0 : 1
      button.classList.toggle('active', outputPorts[key] === 1)

      fetch('http://94.158.53.18:4480/power/outputs', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ OutputPorts: outputPorts })
      })
      .then(res => res.json())
      .then(data => console.log('POST success:', data))
      .catch(err => console.error('POST error:', err))
    }

    // === Получаем inputs с сервера ===
    function updateInputs() {
      fetch('http://94.158.53.18:4480/power/inputs')
        .then(res => res.json())
        .then(data => {
          const inputs = data.InputPorts || {}
          for (let i = 1; i <= 6; i++) {
            const indicator = document.getElementById(`in${i}`)
            const value = inputs[String(i)]
            indicator.classList.toggle('active', value === 1)
          }
        })
        .catch(err => console.error('Inputs fetch error:', err))
    }

    // === Получаем outputs с сервера ===
    function updateOutputs() {
      fetch('http://94.158.53.18:4480/power/outputs')
        .then(res => res.json())
        .then(data => {
          outputPorts = data.OutputPorts || {}
          for (let i = 1; i <= 6; i++) {
            const button = document.getElementById(`out${i}`)
            const value = outputPorts[String(i)]
            button.classList.toggle('active', value === 1)
          }
        })
        .catch(err => console.error('Outputs fetch error:', err))
    }

    // === Стартуем синхронизацию ===
    updateInputs()
    updateOutputs()
    setInterval(updateInputs, 1000)
    setInterval(updateOutputs, 2000)
  </script>
</body>
</html>
