<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Toggle Control Panel</title>
  <style>
    .toggle, .indicator {
      display: inline-block;
      margin: 10px;
      padding: 10px 20px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .active {
      background-color: lightgreen;
    }

    .indicator {
      background-color: #f2f2f2;
    }

    .indicator.active {
      background-color: lightskyblue;
    }
  </style>
</head>
<body>
  <h1>Control Panel</h1>

  <h2>Outputs</h2>
  <div id="toggles">
    <button class="toggle" id="out1" onclick="toggle(1)">OUT 1</button>
    <button class="toggle" id="out2" onclick="toggle(2)">OUT 2</button>
    <button class="toggle" id="out3" onclick="toggle(3)">OUT 3</button>
    <button class="toggle" id="out4" onclick="toggle(4)">OUT 4</button>
    <button class="toggle" id="out5" onclick="toggle(5)">OUT 5</button>
    <button class="toggle" id="out6" onclick="toggle(6)">OUT 6</button>
  </div>

  <h2>Inputs</h2>
  <div id="inputs">
    <div class="indicator" id="in1">IN 1</div>
    <div class="indicator" id="in2">IN 2</div>
    <div class="indicator" id="in3">IN 3</div>
    <div class="indicator" id="in4">IN 4</div>
    <div class="indicator" id="in5">IN 5</div>
    <div class="indicator" id="in6">IN 6</div>
  </div>

  <script>
    const outputPorts = {
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0
    };

    function toggle(index) {
      const key = String(index);
      const button = document.getElementById(`out${key}`);

      outputPorts[key] = outputPorts[key] === 0 ? 1 : 0;
      button.classList.toggle('active', outputPorts[key] === 1);

      fetch('http://94.158.53.18:4480/power/outputs', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ OutputPorts: outputPorts })
      })
      .then(response => response.text())
      .then(data => {
        console.log(`Success:`, data);
      })
      .catch(error => {
        console.error(`Error:`, error);
      });
    }

    function updateInputsFromServer() {
      fetch('http://94.158.53.18:4480/power/inputs')
        .then(res => res.json())
        .then(data => {
          const inputs = data.InputPorts || {};
          const outputs = data.OutputPorts || {};

          // Обновление входов
          for (let i = 1; i <= 6; i++) {
            const indicator = document.getElementById(`in${i}`);
            const value = inputs[String(i)];
            indicator.classList.toggle('active', value === 1);
          }

          // Обновление кнопок по факту (если кто-то другой изменил Output)
          for (let i = 1; i <= 6; i++) {
            const button = document.getElementById(`out${i}`);
            const value = outputs[String(i)];
            outputPorts[String(i)] = value;
            button.classList.toggle('active', value === 1);
          }
        })
        .catch(err => console.error('Failed to fetch input states:', err));
    }

    setInterval(updateInputsFromServer, 1000); // обновление каждую секунду
  </script>
</body>
</html>
